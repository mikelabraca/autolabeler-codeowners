{"version":3,"file":"index.js","sources":["../dist-src/get-oauth-access-token.js","../dist-src/requires-basic-auth.js","../dist-src/auth.js","../dist-src/hook.js","../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["import { RequestError } from \"@octokit/request-error\";\nexport async function getOAuthAccessToken(state, options) {\n    var _a, _b, _c, _d;\n    /* istanbul ignore next: coverage probles with optional chaning */\n    const authOptionsPassed = typeof ((_b = (_a = options) === null || _a === void 0 ? void 0 : _a.auth) === null || _b === void 0 ? void 0 : _b.code) !== \"undefined\";\n    const authOptions = authOptionsPassed\n        ? /* istanbul ignore next: coverage probles with optional chaning */\n            (_c = options) === null || _c === void 0 ? void 0 : _c.auth\n        : state;\n    if (state.token && !authOptionsPassed) {\n        return state.token;\n    }\n    // The \"/login/oauth/access_token\" is not part of the REST API hosted on api.github.com,\n    // instead it’s using the github.com domain.\n    const route = /^https:\\/\\/(api\\.)?github\\.com$/.test(state.request.endpoint.DEFAULTS.baseUrl)\n        ? \"POST https://github.com/login/oauth/access_token\"\n        : `POST ${state.request.endpoint.DEFAULTS.baseUrl.replace(\"/api/v3\", \"/login/oauth/access_token\")}`;\n    /* istanbul ignore next: coverage probles with optional chaning */\n    const request = ((_d = options) === null || _d === void 0 ? void 0 : _d.request) || state.request;\n    const parameters = {\n        headers: {\n            accept: \"application/json\"\n        },\n        client_id: state.clientId,\n        client_secret: state.clientSecret,\n        code: authOptions.code,\n        redirect_uri: authOptions.redirectUrl,\n        state: authOptions.state\n    };\n    const response = await request(route, parameters);\n    if (response.data.error !== undefined) {\n        throw new RequestError(`${response.data.error_description} (${response.data.error})`, response.status, {\n            headers: response.headers,\n            request: request.endpoint(route, parameters)\n        });\n    }\n    const { data } = response;\n    const newToken = {\n        token: data.access_token,\n        scopes: data.scope.split(/,\\s*/).filter(Boolean)\n    };\n    if (!authOptionsPassed) {\n        state.token = newToken;\n    }\n    return newToken;\n}\n","/**\n * An OAuth app authenticates using ?client_id=...&client_secret=... query parameters, with the\n * exception of these three endpoints, which require the client ID/secret to be sent as basic auth\n *\n * - [`POST /applications/:client_id/token`](https://developer.github.com/v3/apps/oauth_applications/#check-a-token) - Check a token\n * - [`PATCH /applications/:client_id/token`](https://developer.github.com/v3/apps/oauth_applications/#reset-a-token) - Reset a token\n * - [`DELETE /applications/:client_id/token`](https://developer.github.com/v3/apps/oauth_applications/#reset-a-token) - Delete an app token\n * - [`DELETE /applications/:client_id/grant`](https://developer.github.com/v3/apps/oauth_applications/#delete-an-app-authorization) - Delete an app authorization\n *\n * deprecated:\n *\n * - [`GET /applications/:client_id/tokens/:access_token`](https://developer.github.com/v3/apps/oauth_applications/#check-an-authorization) - Check an authorization\n * - [`POST /applications/:client_id/tokens/:access_token`](https://developer.github.com/v3/apps/oauth_applications/#reset-an-authorization) - Reset an authorization\n * - [`DELETE /applications/:client_id/tokens/:access_token`](https://developer.github.com/v3/apps/oauth_applications/#revoke-an-authorization-for-an-application) - Revoke an authorization for an application\n * - [`DELETE /applications/:client_id/grants/:access_token`](https://developer.github.com/v3/apps/oauth_applications/#revoke-a-grant-for-an-application) - Revoke a grant for an application\n */\nconst OAUTH_ROUTES_EXCEPTIONS = /\\/applications\\/:?[\\w_]+\\/(token|grant)(s\\/:?[\\w_]+)?($|\\?)/;\nexport function requiresBasicAuth(url) {\n    return url && OAUTH_ROUTES_EXCEPTIONS.test(url);\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nimport { requiresBasicAuth } from \"./requires-basic-auth\";\nexport async function auth(state, authOptions) {\n    if (authOptions.type === \"token\") {\n        const { token, scopes } = await getOAuthAccessToken(state, {\n            auth: authOptions\n        });\n        return {\n            type: \"token\",\n            token,\n            tokenType: \"oauth\",\n            scopes\n        };\n    }\n    const [headers, query] = requiresBasicAuth(authOptions.url)\n        ? [\n            {\n                authorization: `basic ${btoa(`${state.clientId}:${state.clientSecret}`)}`\n            },\n            {}\n        ]\n        : [\n            {},\n            {\n                client_id: state.clientId,\n                client_secret: state.clientSecret\n            }\n        ];\n    return {\n        type: \"oauth-app\",\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        headers,\n        query\n    };\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nimport { requiresBasicAuth } from \"./requires-basic-auth\";\nexport async function hook(state, request, route, parameters) {\n    let endpoint = request.endpoint.merge(route, parameters);\n    // Do not intercept request to retrieve a new token\n    if (/\\/login\\/oauth\\/access_token$/.test(endpoint.url)) {\n        return request(endpoint);\n    }\n    const { token } = await getOAuthAccessToken(state, { request });\n    if (!requiresBasicAuth(endpoint.url)) {\n        endpoint.headers.authorization = `token ${token}`;\n        return request(endpoint);\n    }\n    const credentials = btoa(`${state.clientId}:${state.clientSecret}`);\n    endpoint.headers.authorization = `basic ${credentials}`;\n    // default `:client_id` & `:access_token` URL parameters\n    if (endpoint.url && /:client_id/.test(endpoint.url)) {\n        endpoint = Object.assign({\n            client_id: state.clientId,\n            access_token: token\n        }, endpoint);\n    }\n    const response = await request(endpoint);\n    // `POST /applications/:client_id/tokens/:access_token` resets the passed token\n    // and returns a new one. If that’s the current request then update internal state.\n    const parsedEndpoint = request.endpoint.parse(endpoint);\n    const isTokenResetRequest = parsedEndpoint.method === \"POST\" &&\n        new RegExp(token).test(parsedEndpoint.url);\n    if (isTokenResetRequest && state.token) {\n        state.token.token = response.data.token;\n    }\n    return response;\n}\n","export const VERSION = \"2.3.3\";\n","import { getUserAgent } from \"universal-user-agent\";\nimport { request } from \"@octokit/request\";\nimport { auth } from \"./auth\";\nimport { hook } from \"./hook\";\nimport { VERSION } from \"./version\";\nexport function createOAuthAppAuth(options) {\n    const state = Object.assign({\n        request: request.defaults({\n            headers: {\n                \"user-agent\": `octokit-auth-oauth-app.js/${VERSION} ${getUserAgent()}`\n            }\n        })\n    }, options);\n    return Object.assign(auth.bind(null, state), {\n        hook: hook.bind(null, state)\n    });\n}\n"],"names":["getOAuthAccessToken","state","options","_a","_b","_c","_d","authOptionsPassed","auth","code","authOptions","token","route","test","request","endpoint","DEFAULTS","baseUrl","replace","parameters","headers","accept","client_id","clientId","client_secret","clientSecret","redirect_uri","redirectUrl","response","data","error","undefined","RequestError","error_description","status","newToken","access_token","scopes","scope","split","filter","Boolean","OAUTH_ROUTES_EXCEPTIONS","requiresBasicAuth","url","type","tokenType","query","authorization","btoa","hook","merge","credentials","Object","assign","parsedEndpoint","parse","isTokenResetRequest","method","RegExp","VERSION","createOAuthAppAuth","defaults","getUserAgent","bind"],"mappings":"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"}