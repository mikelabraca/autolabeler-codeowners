{"version":3,"file":"index.js","sources":["../dist-src/get-oauth-access-token.js","../dist-src/requires-basic-auth.js","../dist-src/auth.js","../dist-src/hook.js","../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["import { RequestError } from \"@octokit/request-error\";\nexport async function getOAuthAccessToken(state, options) {\n    var _a, _b, _c, _d;\n    /* istanbul ignore next: coverage probles with optional chaning */\n    const authOptionsPassed = typeof ((_b = (_a = options) === null || _a === void 0 ? void 0 : _a.auth) === null || _b === void 0 ? void 0 : _b.code) !== \"undefined\";\n    const authOptions = authOptionsPassed\n        ? /* istanbul ignore next: coverage probles with optional chaning */\n            (_c = options) === null || _c === void 0 ? void 0 : _c.auth\n        : state;\n    if (state.token && !authOptionsPassed) {\n        return state.token;\n    }\n    // The \"/login/oauth/access_token\" is not part of the REST API hosted on api.github.com,\n    // instead it’s using the github.com domain.\n    const route = /^https:\\/\\/(api\\.)?github\\.com$/.test(state.request.endpoint.DEFAULTS.baseUrl)\n        ? \"POST https://github.com/login/oauth/access_token\"\n        : `POST ${state.request.endpoint.DEFAULTS.baseUrl.replace(\"/api/v3\", \"/login/oauth/access_token\")}`;\n    /* istanbul ignore next: coverage probles with optional chaning */\n    const request = ((_d = options) === null || _d === void 0 ? void 0 : _d.request) || state.request;\n    const parameters = {\n        headers: {\n            accept: \"application/json\"\n        },\n        client_id: state.clientId,\n        client_secret: state.clientSecret,\n        code: authOptions.code,\n        redirect_uri: authOptions.redirectUrl,\n        state: authOptions.state\n    };\n    const response = await request(route, parameters);\n    if (response.data.error !== undefined) {\n        throw new RequestError(`${response.data.error_description} (${response.data.error})`, response.status, {\n            headers: response.headers,\n            request: request.endpoint(route, parameters)\n        });\n    }\n    const { data } = response;\n    const newToken = {\n        token: data.access_token,\n        scopes: data.scope.split(/,\\s*/).filter(Boolean)\n    };\n    if (!authOptionsPassed) {\n        state.token = newToken;\n    }\n    return newToken;\n}\n","/**\n * An OAuth app authenticates using ?client_id=...&client_secret=... query parameters, with the\n * exception of these three endpoints, which require the client ID/secret to be sent as basic auth\n *\n * - [`POST /applications/:client_id/token`](https://developer.github.com/v3/apps/oauth_applications/#check-a-token) - Check a token\n * - [`PATCH /applications/:client_id/token`](https://developer.github.com/v3/apps/oauth_applications/#reset-a-token) - Reset a token\n * - [`DELETE /applications/:client_id/token`](https://developer.github.com/v3/apps/oauth_applications/#reset-a-token) - Delete an app token\n * - [`DELETE /applications/:client_id/grant`](https://developer.github.com/v3/apps/oauth_applications/#delete-an-app-authorization) - Delete an app authorization\n *\n * deprecated:\n *\n * - [`GET /applications/:client_id/tokens/:access_token`](https://developer.github.com/v3/apps/oauth_applications/#check-an-authorization) - Check an authorization\n * - [`POST /applications/:client_id/tokens/:access_token`](https://developer.github.com/v3/apps/oauth_applications/#reset-an-authorization) - Reset an authorization\n * - [`DELETE /applications/:client_id/tokens/:access_token`](https://developer.github.com/v3/apps/oauth_applications/#revoke-an-authorization-for-an-application) - Revoke an authorization for an application\n * - [`DELETE /applications/:client_id/grants/:access_token`](https://developer.github.com/v3/apps/oauth_applications/#revoke-a-grant-for-an-application) - Revoke a grant for an application\n */\nconst OAUTH_ROUTES_EXCEPTIONS = /\\/applications\\/:?[\\w_]+\\/(token|grant)(s\\/:?[\\w_]+)?($|\\?)/;\nexport function requiresBasicAuth(url) {\n    return url && OAUTH_ROUTES_EXCEPTIONS.test(url);\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nimport { requiresBasicAuth } from \"./requires-basic-auth\";\nexport async function auth(state, authOptions) {\n    if (authOptions.type === \"token\") {\n        const { token, scopes } = await getOAuthAccessToken(state, {\n            auth: authOptions\n        });\n        return {\n            type: \"token\",\n            token,\n            tokenType: \"oauth\",\n            scopes\n        };\n    }\n    const [headers, query] = requiresBasicAuth(authOptions.url)\n        ? [\n            {\n                authorization: `basic ${btoa(`${state.clientId}:${state.clientSecret}`)}`\n            },\n            {}\n        ]\n        : [\n            {},\n            {\n                client_id: state.clientId,\n                client_secret: state.clientSecret\n            }\n        ];\n    return {\n        type: \"oauth-app\",\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        headers,\n        query\n    };\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nimport { requiresBasicAuth } from \"./requires-basic-auth\";\nexport async function hook(state, request, route, parameters) {\n    let endpoint = request.endpoint.merge(route, parameters);\n    // Do not intercept request to retrieve a new token\n    if (/\\/login\\/oauth\\/access_token$/.test(endpoint.url)) {\n        return request(endpoint);\n    }\n    const { token } = await getOAuthAccessToken(state, { request });\n    if (!requiresBasicAuth(endpoint.url)) {\n        endpoint.headers.authorization = `token ${token}`;\n        return request(endpoint);\n    }\n    const credentials = btoa(`${state.clientId}:${state.clientSecret}`);\n    endpoint.headers.authorization = `basic ${credentials}`;\n    // default `:client_id` & `:access_token` URL parameters\n    if (endpoint.url && /:client_id/.test(endpoint.url)) {\n        endpoint = Object.assign({\n            client_id: state.clientId,\n            access_token: token\n        }, endpoint);\n    }\n    const response = await request(endpoint);\n    // `POST /applications/:client_id/tokens/:access_token` resets the passed token\n    // and returns a new one. If that’s the current request then update internal state.\n    const parsedEndpoint = request.endpoint.parse(endpoint);\n    const isTokenResetRequest = parsedEndpoint.method === \"POST\" &&\n        new RegExp(token).test(parsedEndpoint.url);\n    if (isTokenResetRequest && state.token) {\n        state.token.token = response.data.token;\n    }\n    return response;\n}\n","export const VERSION = \"2.3.3\";\n","import { getUserAgent } from \"universal-user-agent\";\nimport { request } from \"@octokit/request\";\nimport { auth } from \"./auth\";\nimport { hook } from \"./hook\";\nimport { VERSION } from \"./version\";\nexport function createOAuthAppAuth(options) {\n    const state = Object.assign({\n        request: request.defaults({\n            headers: {\n                \"user-agent\": `octokit-auth-oauth-app.js/${VERSION} ${getUserAgent()}`\n            }\n        })\n    }, options);\n    return Object.assign(auth.bind(null, state), {\n        hook: hook.bind(null, state)\n    });\n}\n"],"names":[],"mappings":"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"}