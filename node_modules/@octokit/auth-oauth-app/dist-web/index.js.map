{"version":3,"file":"index.js","sources":["../dist-src/get-oauth-access-token.js","../dist-src/requires-basic-auth.js","../dist-src/auth.js","../dist-src/hook.js","../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["import { RequestError } from \"@octokit/request-error\";\nexport async function getOAuthAccessToken(state, customRequest) {\n    if (!state.token) {\n        // The \"/login/oauth/access_token\" is not part of the REST API hosted on api.github.com,\n        // instead it’s using the github.com domain.\n        const route = /^https:\\/\\/(api\\.)?github\\.com$/.test(state.request.endpoint.DEFAULTS.baseUrl)\n            ? \"POST https://github.com/login/oauth/access_token\"\n            : `POST ${state.request.endpoint.DEFAULTS.baseUrl.replace(\"/api/v3\", \"/login/oauth/access_token\")}`;\n        const request = customRequest || state.request;\n        const parameters = {\n            headers: {\n                accept: \"application/json\"\n            },\n            client_id: state.clientId,\n            client_secret: state.clientSecret,\n            code: state.code,\n            redirect_uri: state.redirectUrl,\n            state: state.state\n        };\n        const response = await request(route, parameters);\n        if (response.data.error !== undefined) {\n            throw new RequestError(`${response.data.error_description} (${response.data.error})`, response.status, {\n                headers: response.headers,\n                request: request.endpoint(route, parameters)\n            });\n        }\n        const { data } = response;\n        state.token = {\n            token: data.access_token,\n            scopes: data.scope.split(/,\\s*/).filter(Boolean)\n        };\n    }\n    return state.token;\n}\n","/**\n * An OAuth app authenticates using ?client_id=...&client_secret=... query parameters, with the\n * exception of these three endpoints, which require the client ID/secret to be sent as basic auth\n * - [`GET /applications/:client_id/tokens/:access_token`](https://developer.github.com/v3/oauth_authorizations/#check-an-authorization) - Check an authorization\n * - [`POST /applications/:client_id/tokens/:access_token`](https://developer.github.com/v3/oauth_authorizations/#reset-an-authorization) - Reset an authorization\n * - [`DELETE /applications/:client_id/tokens/:access_token`](https://developer.github.com/v3/oauth_authorizations/#revoke-an-authorization-for-an-application) - Revoke an authorization for an application\n */\nconst OAUTH_ROUTES_EXCEPTIONS_REGEX = /\\/applications\\/:?[\\w_]+\\/tokens\\/:?[\\w_]+($|\\?)/;\nexport function requiresBasicAuth(url) {\n    return url && OAUTH_ROUTES_EXCEPTIONS_REGEX.test(url);\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nimport { requiresBasicAuth } from \"./requires-basic-auth\";\nexport async function auth(state, authOptions) {\n    if (authOptions.type === \"token\") {\n        const { token, scopes } = await getOAuthAccessToken(state);\n        return {\n            type: \"token\",\n            token,\n            tokenType: \"oauth\",\n            scopes\n        };\n    }\n    const [headers, query] = requiresBasicAuth(authOptions.url)\n        ? [\n            {\n                authorization: `basic ${btoa(`${state.clientId}:${state.clientSecret}`)}`\n            },\n            {}\n        ]\n        : [\n            {},\n            {\n                client_id: state.clientId,\n                client_secret: state.clientSecret\n            }\n        ];\n    return {\n        type: \"oauth-app\",\n        clientId: state.clientId,\n        clientSecret: state.clientSecret,\n        headers,\n        query\n    };\n}\n","import btoa from \"btoa-lite\";\nimport { getOAuthAccessToken } from \"./get-oauth-access-token\";\nimport { requiresBasicAuth } from \"./requires-basic-auth\";\nexport async function hook(state, request, route, parameters) {\n    let endpoint = request.endpoint.merge(route, parameters);\n    const { token } = await getOAuthAccessToken(state, request);\n    if (!requiresBasicAuth(endpoint.url)) {\n        endpoint.headers.authorization = `token ${token}`;\n        return request(endpoint);\n    }\n    const credentials = btoa(`${state.clientId}:${state.clientSecret}`);\n    endpoint.headers.authorization = `basic ${credentials}`;\n    // default `:client_id` & `:access_token` URL parameters\n    if (endpoint.url && /:client_id/.test(endpoint.url)) {\n        endpoint = Object.assign({\n            client_id: state.clientId,\n            access_token: token\n        }, endpoint);\n    }\n    const response = await request(endpoint);\n    // `POST /applications/:client_id/tokens/:access_token` resets the passed token\n    // and returns a new one. If that’s the current request then update internal state.\n    const parsedEndpoint = request.endpoint.parse(endpoint);\n    const isTokenResetRequest = parsedEndpoint.method === \"POST\" &&\n        new RegExp(token).test(parsedEndpoint.url);\n    if (isTokenResetRequest && state.token) {\n        state.token.token = response.data.token;\n    }\n    return response;\n}\n","export const VERSION = \"2.2.1\";\n","import { getUserAgent } from \"universal-user-agent\";\nimport { request } from \"@octokit/request\";\nimport { auth } from \"./auth\";\nimport { hook } from \"./hook\";\nimport { VERSION } from \"./version\";\nexport function createOAuthAppAuth(options) {\n    const state = Object.assign({\n        request: request.defaults({\n            headers: {\n                \"user-agent\": `octokit-auth-oauth-app.js/${VERSION} ${getUserAgent()}`\n            }\n        })\n    }, options);\n    return Object.assign(auth.bind(null, state), {\n        hook: hook.bind(null, state)\n    });\n}\n"],"names":[],"mappings":"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"}